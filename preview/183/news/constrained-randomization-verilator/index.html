<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=5">
<link href=/preview/183/vendor/bootstrap/bootstrap.min.css rel=stylesheet>
<link href=/preview/183/vendor/phosphor-icons/css/phosphor.css rel=stylesheet>
<link href=/preview/183/vendor/magnific-popup/magnific-popup.css rel=stylesheet>
<link rel=stylesheet href=/preview/183/scss/theme.min.53fa887b01836c4fd2231659f9c9f611f2bfeb6c256dfea6461be73843594049.css>
<link rel=icon href=/preview/183/images/favicon/cropped-favicon-1-32x32.png sizes=32x32>
<link rel=icon href=/preview/183/images/favicon/cropped-favicon-1-192x192.png sizes=192x192>
<link rel=apple-touch-icon href=/preview/183/images/favicon/cropped-favicon-1-180x180.png>
<meta name=msapplication-TileImage content="/preview/183/images/favicon/cropped-favicon-1-270x270.png">
<script src=https://cmp.osano.com/16A0DbT9yDNIaQkvZ/3b49aaa9-15ab-4d47-a8fb-96cc25b5543c/osano.js></script>
<title>Constrained randomization in Verilator | CHIPS Alliance</title>
<meta name=description content="Digital design verification often utilizes the so-called constrained randomization functionality offered by SystemVerilog, where in order to …">
<meta property="og:title" content="Constrained randomization in Verilator">
<meta property="og:description" content="Digital design verification often utilizes the so-called constrained randomization functionality offered by SystemVerilog, where in order to efficiently test designs with random but still correct data, a digital logic designer can put constraints in place. This allows verification tests to run shorter by focusing the validation of the design’s behavior on input that the designer considers useful and interesting.
A few months ago Antmicro introduced constrained randomization to Verilator - another significant milestone on the way towards full open source support for SystemVerilog and industry-prevalent UVM testbenches.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://chipsalliance.org/preview/183/news/constrained-randomization-verilator/"><meta property="og:image" content="https://chipsalliance.org/preview/183/news/constrained-randomization-verilator/Constrained-randomization-in-Verilator--blog-sm--CHIPS.png"><meta property="article:section" content="news">
<meta property="article:published_time" content="2025-01-21T00:00:00+00:00">
<meta property="article:modified_time" content="2025-01-21T00:00:00+00:00"><meta property="og:site_name" content="CHIPS Alliance">
<meta itemprop=name content="Constrained randomization in Verilator">
<meta itemprop=description content="Digital design verification often utilizes the so-called constrained randomization functionality offered by SystemVerilog, where in order to efficiently test designs with random but still correct data, a digital logic designer can put constraints in place. This allows verification tests to run shorter by focusing the validation of the design’s behavior on input that the designer considers useful and interesting.
A few months ago Antmicro introduced constrained randomization to Verilator - another significant milestone on the way towards full open source support for SystemVerilog and industry-prevalent UVM testbenches."><meta itemprop=datePublished content="2025-01-21T00:00:00+00:00">
<meta itemprop=dateModified content="2025-01-21T00:00:00+00:00">
<meta itemprop=wordCount content="900"><meta itemprop=image content="https://chipsalliance.org/preview/183/news/constrained-randomization-verilator/Constrained-randomization-in-Verilator--blog-sm--CHIPS.png">
<meta itemprop=keywords content><meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://chipsalliance.org/preview/183/news/constrained-randomization-verilator/Constrained-randomization-in-Verilator--blog-sm--CHIPS.png">
<meta name=twitter:title content="Constrained randomization in Verilator">
<meta name=twitter:description content="Digital design verification often utilizes the so-called constrained randomization functionality offered by SystemVerilog, where in order to efficiently test designs with random but still correct data, a digital logic designer can put constraints in place. This allows verification tests to run shorter by focusing the validation of the design’s behavior on input that the designer considers useful and interesting.
A few months ago Antmicro introduced constrained randomization to Verilator - another significant milestone on the way towards full open source support for SystemVerilog and industry-prevalent UVM testbenches.">
<meta name=twitter:site content="@chipsalliance">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H0KF2YZTR7"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-H0KF2YZTR7')</script>
</head>
<body>
<header>
<div class="lfprojects position-fixed">
<a href=https://www.linuxfoundation.org/projects target=_blank rel="noopener noreferrer"><img src=/preview/183/images/lf-projects-banner-white.svg></a>
</div>
<nav class="navbar navbar-expand-lg position-fixed w-100 zindex-dropdown" id=mainnavigationBar>
<a class=navbar-brand href=/preview/183/>
<img src=/preview/183/images/chips_alliance.svg alt=Nav-Logo>
</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-default><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><line x1="3.5" y1="5.5" x2="21.5" y2="5.5" stroke="#292d32" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><line x1="4.5" y1="12.5" x2="21.5" y2="12.5" stroke="#292d32" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.5" y1="19.5" x2="21.5" y2="19.5" stroke="#292d32" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
</span>
<span class=navbar-toggler-toggled><svg width="20" height="20" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21.5 6.5l-15 15" stroke="#404152" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><path d="M21.5 21.5l-15-15" stroke="#404152" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
</span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav mx-auto mb-20 mb-lg-0 navbar-nav-scroll">
<li class="nav-item dropdown">
<div class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true aria-expanded=false>
About
</div>
<div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/preview/183/about/who-we-are/>Who We Are</a>
<a class=dropdown-item href=/preview/183/about/members/>Members</a>
<a class=dropdown-item href=/preview/183/about/governance/>Governance</a>
<a class=dropdown-item href=/preview/183/about/faq/>FAQ</a>
<a class=dropdown-item href=/preview/183/about/contact/>Contact</a>
</div>
</li>
<li class=nav-item>
<a class=nav-link href=/preview/183/projects/>
Projects
</a>
</li>
<li class=nav-item>
<a class=nav-link href=/preview/183/events/>
Events
</a>
</li>
<li class=nav-item>
<a class=nav-link href=/preview/183/workgroups/>
Workgroups
</a>
</li>
<li class="nav-item dropdown">
<div class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true aria-expanded=false>
News
</div>
<div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/preview/183/categories/announcements/>Announcements</a>
<a class=dropdown-item href=/preview/183/categories/blog/>Blog</a>
<a class=dropdown-item href=/preview/183/categories/reports/>Reports</a>
</div>
</li>
<li class=nav-item>
<a class=nav-link href=/preview/183/join/>
Join
</a>
</li>
</ul>
</div>
<div class="d-none d-lg-block">
<div class=nav-item>
<a href=/preview/183/getting-started/ class="btn btn-sm btn-primary">Get Started</a>
</div>
</div>
</nav>
</header>
<section class=blog-details>
<div class=container>
<div class=row>
<div class=col-lg-12>
<article class=blog-single>
<div class=inner-blog-details>
<h1>Constrained randomization in Verilator</h1>
<div class=inner-blog-details-meta>
<ul class=list-unstyled>
<li class=list-inline-item>
<p>January 21, 2025</p>
</li>
<li class=list-inline-item>
<p>5 <span>minutes</span></p>
</li>
<li class=list-inline-item>
<p>900 <span>words</span></p>
</li>
</ul>
</div>
</div>
<div class="rounded-box mb-xxl-11 mb-8">
<img src=https://chipsalliance.org/preview/183/news/constrained-randomization-verilator/Constrained-randomization-in-Verilator--blog-sm--CHIPS.png class=w-100 alt=featured-image>
</div>
<div><p>Digital design verification often utilizes the so-called constrained randomization functionality offered by SystemVerilog, where in order to efficiently test designs with random but still correct data, a digital logic designer can put constraints in place. This allows verification tests to run shorter by focusing the validation of the design’s behavior on input that the designer considers useful and interesting.</p>
<p>A few months ago Antmicro <a href=https://antmicro.com/blog/2024/03/introducing-constrained-randomization-in-verilator/>introduced constrained randomization to Verilator</a> - another significant milestone on the way towards full open source support for SystemVerilog and industry-prevalent <a href=https://antmicro.com/blog/2023/10/running-simple-uvm-testbenches-in-verilator/>UVM testbenches</a>. This work has been highly anticipated by many industrial users and is allowing Antmicro to slowly but steadily adopt Verilator for UVM-style verification in their state of the art silicon development work like CHIPS Alliance’s <a href=https://github.com/chipsalliance/Caliptra>Caliptra Root of Trust</a> project.</p>
<p>With this article, in order to shed more light on the progress and the internals of Antmicro’s approach, we take a deeper dive into the role of Satisfiability Modulo Theories (SMT) solvers (such as <a href=https://github.com/Z3Prover/z3>z3</a> and <a href=https://cvc5.github.io/>cvc5</a>) in the implementation of randomization constraints, conversion of SystemVerilog expressions to the <a href=https://smt-lib.org/>SMT-LIB2</a> language, the details of the integration of the solvers into Verilator, as well as considerations for further extending the SystemVerilog support.</p>
<p><img src=Constrained-randomization-in-Verilator--blog-sm--CHIPS.svg alt="Constrained randomization in Verilator: SystemVerilog constraint to SMT-LIB2 conversion"></p>
<h3 id=systemverilog-to-smt-lib2>SystemVerilog to SMT-LIB2</h3>
<p>The current solution that Antmicro <a href=https://github.com/verilator/verilator/pull/4947>introduced to upstream Verilator</a> involves converting SystemVerilog expressions to SMT-LIB2, a Lisp-like language that describes Satisfiability Modulo Theories (SMT) problems in terms of functions (variables are 0-argument functions in SMT), and constraints (“assertions” in SMT jargon).</p>
<p>Presented below is a sample problem statement for integer factorization in the SMT-LIB2 language:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lisp data-lang=lisp>(set-option <span style=color:#e6db74>:produce-models</span> true)
(set-logic QF_BV)
(declare-fun x () (_ BitVec <span style=color:#ae81ff>32</span>))
(declare-fun y () (_ BitVec <span style=color:#ae81ff>32</span>))
(declare-fun z () (_ BitVec <span style=color:#ae81ff>32</span>))
(assert (<span style=color:#a6e22e>=</span> <span style=color:#ae81ff>#x00006161</span> z))
(assert (<span style=color:#a6e22e>=</span> (bvmul x y) z))
(assert (and (bvult x z) (bvult y z)))
(assert (bvult x y))
(check-sat)
</code></pre></div><p>To which an SMT-LIB2 compliant solver will respond, confirming that the stated problem is satisfiable:</p>
<pre tabindex=0><code>sat
</code></pre><p>It can then be queried about the exact solution:</p>
<pre tabindex=0><code>(get-value (x y))
</code></pre><p>And then the solver will respond with an actual factorization it has found:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lisp data-lang=lisp>((x <span style=color:#ae81ff>#x00000061</span>)
   (y <span style=color:#ae81ff>#x00000101</span>))
</code></pre></div><h3 id=implementation>Implementation</h3>
<p>The integer factorization problem from the section above can be expressed as a SystemVerilog class, for example:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-systemverilog data-lang=systemverilog><span style=color:#66d9ef>class</span> Cls;
    <span style=color:#66d9ef>rand</span> <span style=color:#66d9ef>bit</span> [<span style=color:#ae81ff>31</span><span style=color:#f92672>:</span><span style=color:#ae81ff>0</span>] x, y, z;
    <span style=color:#66d9ef>constraint</span> factor {
        z <span style=color:#f92672>==</span> <span style=color:#ae81ff>32</span><span style=color:#960050;background-color:#1e0010>’</span>h6161;
        x <span style=color:#f92672>*</span> y <span style=color:#f92672>==</span> z;
        x <span style=color:#f92672>&lt;</span> z <span style=color:#f92672>&amp;&amp;</span> y <span style=color:#f92672>&lt;</span> z;
    }
    <span style=color:#66d9ef>constraint</span> stable {
        x <span style=color:#f92672>&lt;</span> y;
    }
<span style=color:#66d9ef>endclass</span>
</code></pre></div><p>If we call the randomize method on an instance of <code>Cls</code>, the constraints are first converted to strings in the SMT-LIB2 format, which Antmicro implemented using the <code>$sformatf</code> system function, converting every sub-expression to a solver-digestible string (e.g. <code>LHS && RHS</code> to <code>$sformatf(“(and %s %s)”, LHS, RHS)</code>). Thanks to constant folding in Verilator, the nested expressions are normalized to a single <code>$sformatf</code> call with just the missing bits left to be filled in at runtime.</p>
<p>Like in Verilator, there are separate functions in the language for signed and unsigned operations on bit vectors. But unlike in SystemVerilog, there are no ‘signed’ and ‘unsigned’ bit vectors - the signedness is determined by the operation, which uses acronyms such as <code>bvslt</code> for “bit vector signed less than”, and <code>bvult</code> for “bit vector unsigned less than”. Each constraint is converted to a separate function that is called when the constraints are gathered.</p>
<h3 id=advantages>Advantages</h3>
<p>Fine-grained control over the communication with the solver and over the passed expressions let Antmicro ensure that the results can get truly random values, even in narrow solution spaces (which is an improvement over <a href=https://antmicro.com/blog/2023/01/open-source-systemverilog-uvm-support-in-verilator/#improving-existing-verilator-features>the previous proof of concept implementation</a>). Solvers are typically deterministic, which is a generally desired feature, except of course when you do want to achieve randomization. Therefore, they decided to add an extra artificial constraint to further narrow down the solution space. The constraint is constructed by forcing a random hash of output variables and forcing it to a random value. A subset of all output bits is selected, XORed together, and an extra <code>assert</code> command is issued forcing the solver to find a different solution, and aiming to introduce enough entropy to its internal state to explore the solution space thoroughly.</p>
<h3 id=future-considerations-state-dependent-and-conditional-constraints>Future considerations: state-dependent and conditional constraints</h3>
<p>State-dependent and conditional constraints, as well as constraints on arrays, are the next possible steps on the way to full constrained randomization support. In order to support arrays, each element should become a separate variable, which requires a relatively complex implementation. Support for dynamic (state-dependent) constraints is currently in progress.</p>
<p>The next potential improvements also include the way 1-bit vectors and booleans are handled. They are currently undistinguishable in Verilator, but they are treated as separate ‘kinds’ in SMT-LIB2 and cannot be mixed. This shortcoming does not surface in most cases, but should you stumble upon it in your design, adding <code>== 1‘b1</code> to convert a 1-bit vector to a boolean is a possible workaround.</p>
<h3 id=integrate-open-and-efficient-asic-verification-into-your-workflows-with-antmicro>Integrate open and efficient ASIC verification into your workflows with Antmicro</h3>
<p>With the effort described above and <a href=https://antmicro.com/blog/tags/verilator/>others before it</a>, developed in part under the guise of the EU-funded <a href=https://tristan-project.eu/>TRISTAN project</a> concerned with open RISC-V SoC development tooling, Antmicro steadily pushes Verilator towards full SystemVerilog support, with the goal of enabling efficient, fully open source verification workflows for complex ASIC projects.</p>
<p>To discuss adoption of the open source toolkit and methodology in your ASIC design verification flows and expanding SystemVerilog and UVM support to benefit your projects, reach out to Antmicro at <a href=mailto:contact@antmicro.com>contact@antmicro.com</a>.</p>
</div>
</article>
</div>
</div>
</div>
</section>
<section class="blog-related position-relative">
<div class=container>
<div class=row>
<div class=col-md-12>
<div class=blog-section>
<h2 class=blog-section-title>Recent News</h2>
</div>
</div>
</div>
<div class=row>
<div class="col-lg-4 col-md-6">
<article class=blog-post>
<div class=blog-post-thumb>
<a href=/preview/183/news/coverage-dashboards-for-veer-and-caliptra/>
<img src=https://chipsalliance.org/preview/183/news/coverage-dashboards-for-veer-and-caliptra/Coverview--chips--blog-sm.png alt=blog-thumb loading=lazy>
</a>
</div>
<div class=blog-post-content>
<div class=blog-post-tag>
<a href=https://chipsalliance.org/preview/183/categories/blog>Blog</a>
</div>
<div class=blog-post-date>
May 22, 2025
</div>
<div class=blog-post-title>
<a href=/preview/183/news/coverage-dashboards-for-veer-and-caliptra/>Generating interactive coverage dashboards for VeeR and Caliptra with Coverview</a>
</div>
</div>
</article>
</div>
<div class="col-lg-4 col-md-6">
<article class=blog-post>
<div class=blog-post-thumb>
<a href=/preview/183/news/tac-whitepaper/>
<img src=https://chipsalliance.org/preview/183/news/tac-whitepaper/chips-alliance-whitepaper.jpg alt=blog-thumb loading=lazy>
</a>
</div>
<div class=blog-post-content>
<div class=blog-post-tag>
<a href=https://chipsalliance.org/preview/183/categories/blog>Blog</a>
</div>
<div class=blog-post-date>
April 28, 2025
</div>
<div class=blog-post-title>
<a href=/preview/183/news/tac-whitepaper/>The Next Chapter in Open Source Silicon- Download the CHIPS Alliance White Paper</a>
</div>
</div>
</article>
</div>
<div class="col-lg-4 col-md-6">
<article class=blog-post>
<div class=blog-post-thumb>
<a href=/preview/183/news/new-revision-of-data-center-rdimm-ddr5-tester/>
<img src=https://chipsalliance.org/preview/183/news/new-revision-of-data-center-rdimm-ddr5-tester/ddr5-tester--blog-sm.png alt=blog-thumb loading=lazy>
</a>
</div>
<div class=blog-post-content>
<div class=blog-post-tag>
<a href=https://chipsalliance.org/preview/183/categories/blog>Blog</a>
</div>
<div class=blog-post-date>
January 30, 2025
</div>
<div class=blog-post-title>
<a href=/preview/183/news/new-revision-of-data-center-rdimm-ddr5-tester/>New revision of Data Center RDIMM DDR5 Tester</a>
</div>
</div>
</article>
</div>
</div>
</div>
</section>
<footer class="footer pt-xxl-19 pt-8 pb-sm-7 pb-5" id=footer>
<div class=container-fluid>
<div class=footer-wrapper>
<div class=row>
<div class="col-12 col-lg-4 me-auto order-2 order-lg-1">
<div class="footer-logo mt-7 mt-md-0 mb-5">
<a href=/preview/183/ class=chips-logo-link>
<img src=/preview/183/images/chips-logo-white.svg alt="CHIPS Allaince Logo">
</a>
<a href=https://www.linuxfoundation.org class=lf-logo-link>
<img src=/preview/183/images/lf-stacked-white.svg alt="Linux Foundation Logo">
</a>
</div>
<div class=social-icon>
<ul class=list-unstyled>
<li>
<a href=https://twitter.com/chipsalliance> <i class=ph-twitter-logo></i> </a>
</li>
<li>
<a href=https://github.com/chipsalliance> <i class=ph-github-logo></i> </a>
</li>
<li>
<a href=https://www.linkedin.com/company/chipsalliance/> <i class=ph-linkedin-logo></i> </a>
</li>
</ul>
</div>
<div class="footer-logo mt-7 mt-md-0">
<p>
© Copyright <span>2025</span> CHIPS Alliance
The Linux Foundation® . All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href=https://www.linuxfoundation.org/trademark-usage>Trademark Usage</a> page. Linux is a registered trademark of Linus Torvalds. <a href=http://www.linuxfoundation.org/privacy>Privacy Policy</a> and <a href=http://www.linuxfoundation.org/terms>Terms of Use</a>.
</p>
</div>
</div>
<div class="col-6 col-md-4 col-sm-4 col-lg-2 order-1">
<div class=footer-widget>
<h3>About</h3>
<ul class=list-unstyled>
<li>
<a href=/preview/183/about/who-we-are/>Who We Are</a>
</li>
<li>
<a href=/preview/183/about/members/>Members</a>
</li>
<li>
<a href=https://members.chipsalliance.org/>Member Support</a>
</li>
<li>
<a href=/preview/183/about/governance/>Governance</a>
</li>
<li>
<a href=/preview/183/about/faq/>FAQ</a>
</li>
<li>
<a href=/preview/183/about/contact/>Contact</a>
</li>
</ul>
</div>
</div>
<div class="col-6 col-md-4 col-sm-4 col-lg-2 order-1">
<div class=footer-widget>
<h3>Community</h3>
<ul class=list-unstyled>
<li>
<a href=/preview/183/projects/>Projects</a>
</li>
<li>
<a href=/preview/183/getting-started/>Getting Started</a>
</li>
<li>
<a href=/preview/183/events/>Events</a>
</li>
<li>
<a href=/preview/183/workgroups/>Workgroups</a>
</li>
</ul>
</div>
</div>
<div class="col-6 col-md-4 col-sm-4 col-lg-2 order-1">
<div class=footer-widget>
<h3>News</h3>
<ul class=list-unstyled>
<li>
<a href=/preview/183/categories/announcements/>Announcements</a>
</li>
<li>
<a href=/preview/183/categories/blog/>Blog</a>
</li>
<li>
<a href=/preview/183/categories/reports/>Reports</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</footer>
<script src=/preview/183/vendor/jQuery/jquery.min.js></script>
<script src=/preview/183/vendor/bootstrap/bootstrap.bundle.min.js></script>
<script src=/preview/183/vendor/counter-up/countup.js></script>
<script src=/preview/183/vendor/magnific-popup/magnific-popup.min.js></script>
<script src=/preview/183/js/script.js></script>
</body>
</html>