<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=5">
<link href=/vendor/bootstrap/bootstrap.min.css rel=stylesheet>
<link href=/vendor/phosphor-icons/css/phosphor.css rel=stylesheet>
<link href=/vendor/magnific-popup/magnific-popup.css rel=stylesheet>
<link rel=stylesheet href=/scss/theme.min.a5381c44cba9afddcecb1f5a7770e438e042e9a03f795caa7ee5af578c5025b5.css>
<link rel=icon href=/images/favicon/cropped-favicon-1-32x32.png sizes=32x32>
<link rel=icon href=/images/favicon/cropped-favicon-1-192x192.png sizes=192x192>
<link rel=apple-touch-icon href=/images/favicon/cropped-favicon-1-180x180.png>
<meta name=msapplication-TileImage content="/images/favicon/cropped-favicon-1-270x270.png">
<script src=https://cmp.osano.com/16A0DbT9yDNIaQkvZ/3b49aaa9-15ab-4d47-a8fb-96cc25b5543c/osano.js></script>
<title>Dynamic Scheduling in Verilator – Milestone Towards Open Source UVM | CHIPS Alliance</title>
<meta name=description content="This post was originally published at Antmicro.
UVM is a verification methodology traditionally used in chip design which has historically been …">
<meta property="og:title" content="Dynamic Scheduling in Verilator – Milestone Towards Open Source UVM">
<meta property="og:description" content="This post was originally published at Antmicro.
UVM is a verification methodology traditionally used in chip design which has historically been missing from the open source landscape of verification-focused tooling. While new, open source approaches to verification have emerged that include the excellent Python-based Cocotb (that we also use and support) maintained by FOSSi Foundation, not everyone can easily adopt it, especially in long-running projects and existing codebases that use a different verification approach.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://chipsalliance.org/news/dynamic-scheduling-in-verilator/"><meta property="og:image" content="https://chipsalliance.org/images/blog-share.jpg"><meta property="article:section" content="news">
<meta property="article:published_time" content="2021-05-13T00:00:00+00:00">
<meta property="article:modified_time" content="2021-05-13T00:00:00+00:00"><meta property="og:site_name" content="CHIPS Alliance">
<meta itemprop=name content="Dynamic Scheduling in Verilator – Milestone Towards Open Source UVM">
<meta itemprop=description content="This post was originally published at Antmicro.
UVM is a verification methodology traditionally used in chip design which has historically been missing from the open source landscape of verification-focused tooling. While new, open source approaches to verification have emerged that include the excellent Python-based Cocotb (that we also use and support) maintained by FOSSi Foundation, not everyone can easily adopt it, especially in long-running projects and existing codebases that use a different verification approach."><meta itemprop=datePublished content="2021-05-13T00:00:00+00:00">
<meta itemprop=dateModified content="2021-05-13T00:00:00+00:00">
<meta itemprop=wordCount content="1032"><meta itemprop=image content="https://chipsalliance.org/images/blog-share.jpg">
<meta itemprop=keywords content><meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://chipsalliance.org/images/blog-share.jpg">
<meta name=twitter:title content="Dynamic Scheduling in Verilator – Milestone Towards Open Source UVM">
<meta name=twitter:description content="This post was originally published at Antmicro.
UVM is a verification methodology traditionally used in chip design which has historically been missing from the open source landscape of verification-focused tooling. While new, open source approaches to verification have emerged that include the excellent Python-based Cocotb (that we also use and support) maintained by FOSSi Foundation, not everyone can easily adopt it, especially in long-running projects and existing codebases that use a different verification approach.">
<meta name=twitter:site content="@chipsalliance">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H0KF2YZTR7"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-H0KF2YZTR7')</script>
</head>
<body>
<header>
<div class="lfprojects position-fixed">
<a href=https://www.linuxfoundation.org/projects target=_blank rel="noopener noreferrer"><img src=/images/lf-projects-banner-white.svg></a>
</div>
<nav class="navbar navbar-expand-lg position-fixed w-100 zindex-dropdown" id=mainnavigationBar>
<a class=navbar-brand href=/>
<img src=/images/chips_alliance.svg alt=Nav-Logo>
</a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-default><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><line x1="3.5" y1="5.5" x2="21.5" y2="5.5" stroke="#292d32" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><line x1="4.5" y1="12.5" x2="21.5" y2="12.5" stroke="#292d32" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.5" y1="19.5" x2="21.5" y2="19.5" stroke="#292d32" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
</span>
<span class=navbar-toggler-toggled><svg width="20" height="20" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21.5 6.5l-15 15" stroke="#404152" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><path d="M21.5 21.5l-15-15" stroke="#404152" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
</span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav mx-auto mb-20 mb-lg-0 navbar-nav-scroll">
<li class="nav-item dropdown">
<div class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true aria-expanded=false>
About
</div>
<div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/about/who-we-are/>Who We Are</a>
<a class=dropdown-item href=/about/members/>Members</a>
<a class=dropdown-item href=/about/governance/>Governance</a>
<a class=dropdown-item href=/about/faq/>FAQ</a>
<a class=dropdown-item href=/about/contact/>Contact</a>
</div>
</li>
<li class=nav-item>
<a class=nav-link href=/projects/>
Projects
</a>
</li>
<li class=nav-item>
<a class=nav-link href=/events/>
Events
</a>
</li>
<li class=nav-item>
<a class=nav-link href=/workgroups/>
Workgroups
</a>
</li>
<li class="nav-item dropdown">
<div class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true aria-expanded=false>
News
</div>
<div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/categories/announcements/>Announcements</a>
<a class=dropdown-item href=/categories/blog/>Blog</a>
<a class=dropdown-item href=/categories/reports/>Reports</a>
</div>
</li>
<li class=nav-item>
<a class=nav-link href=/join/>
Join
</a>
</li>
</ul>
</div>
<div class="d-none d-lg-block">
<div class=nav-item>
<a href=/getting-started/ class="btn btn-sm btn-primary">Get Started</a>
</div>
</div>
</nav>
</header>
<section class=blog-details>
<div class=container>
<div class=row>
<div class=col-lg-12>
<article class=blog-single>
<div class=inner-blog-details>
<h1>Dynamic Scheduling in Verilator – Milestone Towards Open Source UVM</h1>
<div class=inner-blog-details-meta>
<ul class=list-unstyled>
<li class=list-inline-item>
<p>May 13, 2021</p>
</li>
<li class=list-inline-item>
<p>5 <span>minutes</span></p>
</li>
<li class=list-inline-item>
<p>1032 <span>words</span></p>
</li>
</ul>
</div>
</div>
<div class="rounded-box mb-xxl-11 mb-8">
<img src=https://chipsalliance.org/images/blog-share.jpg class=w-100 alt=featured-image>
</div>
<div><p><em>This post was originally published at <a href=https://antmicro.com/blog/2021/05/dynamic-scheduling-in-verilator/>Antmicro</a>.</em></p>
<p>UVM is a verification methodology traditionally used in chip design which has historically been missing from the open source landscape of verification-focused tooling. While new, open source approaches to verification have emerged that include the excellent Python-based Cocotb (that <a href=https://antmicro.com/blog/2019/12/testing-usb-cores-with-python-and-cocotb/>we also use</a> <a href=https://antmicro.com/blog/2019/06/verilog-with-cocotb-and-verilator/>and support</a>) maintained by <a href=https://www.fossi-foundation.org/>FOSSi Foundation</a>, not everyone can easily adopt it, especially in long-running projects and existing codebases that use a different verification approach. Leading the efforts towards comprehensive UVM / SystemVerilog support in open source tools, we have been gradually completing milestones, getting closer to what will essentially be a modular, collaboration-driven chips design methodology/workflow. Some examples of our activity in this space include <a href=https://antmicro.com/blog/2020/12/ibex-support-in-verilator-yosys-via-uhdm-surelog/>enabling open source synthesis and simulation of the Ibex CPU</a> in <a href=https://github.com/antmicro/verilator/tree/uhdm-verilator>Verilator</a>/<a href=https://github.com/antmicro/yosys/tree/uhdm-yosys>Yosys</a> via UHDM/Surelog, and the most recent joint project with Western Digital in which we have developed <a href=https://github.com/antmicro/verilator-dynamic-scheduler-examples>dynamic scheduling in Verilator</a>.</p>
<h2 id=verilating-non-synthesizable-code>Verilating non-synthesizable code</h2>
<p>The work is a part of a wider, long-term effort that, besides Western Digital, has involved other fellow CHIPS Alliance members such as Google, to develop UVM / SystemVerilog support in open source tools. To get closer to this goal, this time we have introduced an improvement to Verilator – an open source tool that is great at doing what it was originally designed to do, that is simulating synthesizable code, but hasn’t been enabling its users to convert non-synthesizable code and run fully fledged testbenches written in Verilog/SystemVerilog. The biggest challenge to opening that possibility turned out to be Verilator’s original scheduler running everything sequentially, which in general is not a bad approach but can get you only so far without actually executing the code in parallel.</p>
<p><img src=dynamic-scheduling-verilator.png alt="Dynamic scheduling in Verilator"></p>
<p>To run proper UVM testbenches in Verilator, we had to be able to properly handle language constructs specifically designed for use in simulation. Those features include delay statements, forks, wait statements and events. To achieve all of this, we needed to add a proof-of-concept dynamic scheduler to Verilator.</p>
<h2 id=how-dynamic-scheduling-in-verilator-works>How dynamic scheduling in Verilator works</h2>
<p>Instead of grouping code blocks of the same type as the original scheduler does, the dynamic scheduler separates the code into many runnable blocks and then creates and spawns a process for each of them (when they are due to be executed). To deal with it we created a new process, which translates to a new high level thread for each initial block, always block, forever block, each block in the fork statement etc. This allows us to pause the execution of one block and continue the execution of other blocks. Blocks can be paused when they encounter simulation control statements like:</p>
<ul>
<li>The wait statement (e.g. <code>wait (rdy == 1);</code> or <code>wait (event_name.triggered)</code>)</li>
<li>Waiting for an event (e.g <code>@event_name;</code>)</li>
<li>A delay (<code>#10;</code>)</li>
<li>Or even a join statement after fork (<code>join</code>, <code>join_any</code> – <code>join_none</code> is also supported, however it is not used to control the execution per se)</li>
</ul>
<p>All of the statements listed above are not supported in Verilator’s original scheduler, so to be able to dynamically control the execution of those already dynamically spawned sub-processes, a way to react to changes in signal/events states needed to be implemented. We did it by wrapping the primitive types used for storing signal values in objects using higher abstraction levels, which now allows us to attach other processes to monitor values of specific signals and execute an arbitrary callback when a signal changes. Note that this is a mechanism used internally to implement the flow control statements and is not visible to the user writing Verilog code.</p>
<p>One additional thing that had to be re-written and adapted to the dynamic scheduler was the way non-blocking assignments are handled.</p>
<p>With a scheduler that is aware of the simulation time and other flow control statements, the same approach originally used by Verilator could not be applied anymore. A way to properly schedule assignments, and execute them in the proper moment was a crucial step in getting all of this to work.</p>
<p>Note that the features described above are the ones that are immediately visible to users of Verilator with the dynamic scheduler. This is however only the tip of the iceberg when it comes to the amount of internal changes needed to be done in Verilator.</p>
<h2 id=example-usage>Example usage</h2>
<p>To present the usage of all the new Verilator features we have created a public <a href=https://github.com/antmicro/verilator-dynamic-scheduler-examples>GitHub repository</a> with a number of example designs and GitHub Actions-based CI simulating them.</p>
<p>The examples range from single feature examples to more complex scenarios simulating a system with two UARTs sending data between each other.</p>
<p>The <a href=https://github.com/antmicro/verilator-dynamic-scheduler-examples/tree/master/examples/uart>UART testbench example</a> uses all the newly added features. It spawns a thread for every simulated UART block and each thread feeds the <a href=https://github.com/alexforencich/verilog-uart>UART IP</a> that is being tested with the predefined data (the “hello world” string in our example).</p>
<p>The UART block reads the data from an AXI stream interface, serializes it and sends it over the TX line.</p>
<p>The received data is available on the output AXI Stream bus.</p>
<p>Each testbench thread introduces a random delay between consecutive data chunk transmission.</p>
<p>The threads are synchronized using SystemVerilog events – e.g. once the data is fed into the UART block over the AXI stream interface, a thread is triggering an event informing the other part of the thread that the data is being transmitted by the IP.
Once transmission is done, another event is triggered informing the first thread that the IP is ready for a new data chunk.</p>
<p>Once all the test data is transferred between both tested UART instances, the threads are joined and data correctness is validated.</p>
<h2 id=next-steps-future-goals>Next steps, future goals</h2>
<p>This ongoing project is a big step towards UVM support in open tools as it not only removes a number of limitations in this area but also opens the door to future developments – which include a number of SystemVerilog features oriented towards verification which were earlier out of scope since open source UVM verification wasn’t on the horizon. Together with the effort to support SystemVerilog in Verilator using UHDM which is part of another ongoing project, in CHIPS Alliance we continue to work towards enabling open source design verification for everyone, which will revolutionize the way chips are built.</p>
</div>
</article>
</div>
</div>
</div>
</section>
<section class="blog-related position-relative">
<div class=container>
<div class=row>
<div class=col-md-12>
<div class=blog-section>
<h2 class=blog-section-title>Recent News</h2>
</div>
</div>
</div>
<div class=row>
<div class="col-lg-4 col-md-6">
<article class=blog-post>
<div class=blog-post-thumb>
<a href=/news/speeding-up-openroad-for-fast-design-feedback/>
<img src=https://chipsalliance.org/news/speeding-up-openroad-for-fast-design-feedback/Speeding-up-OpenROAD-optimizations-blog-1.png alt=blog-thumb loading=lazy>
</a>
</div>
<div class=blog-post-content>
<div class=blog-post-tag>
<a href=https://chipsalliance.org/categories/blog>Blog</a>
</div>
<div class=blog-post-date>
May 24, 2024
</div>
<div class=blog-post-title>
<a href=/news/speeding-up-openroad-for-fast-design-feedback/>Speeding Up OpenROAD For Fast Design Feedback</a>
</div>
</div>
</article>
</div>
<div class="col-lg-4 col-md-6">
<article class=blog-post>
<div class=blog-post-thumb>
<a href=/news/adding-physical-memory-protection-to-the-veer-el2-risc-v-core/>
<img src=https://chipsalliance.org/news/adding-physical-memory-protection-to-the-veer-el2-risc-v-core/pmp-thumbnail.png alt=blog-thumb loading=lazy>
</a>
</div>
<div class=blog-post-content>
<div class=blog-post-tag>
<a href=https://chipsalliance.org/categories/blog>Blog</a>
</div>
<div class=blog-post-date>
March 25, 2024
</div>
<div class=blog-post-title>
<a href=/news/adding-physical-memory-protection-to-the-veer-el2-risc-v-core/>Adding Physical Memory Protection to the VeeR EL2 RISC-V Core</a>
</div>
</div>
</article>
</div>
<div class="col-lg-4 col-md-6">
<article class=blog-post>
<div class=blog-post-thumb>
<a href=/news/analyze-verilator-processes/>
<img src=https://chipsalliance.org/news/analyze-verilator-processes/Verilator-helper-tools--blog-sm.png alt=blog-thumb loading=lazy>
</a>
</div>
<div class=blog-post-content>
<div class=blog-post-tag>
<a href=https://chipsalliance.org/categories/blog>Blog</a>
</div>
<div class=blog-post-date>
March 18, 2024
</div>
<div class=blog-post-title>
<a href=/news/analyze-verilator-processes/>Analyze Verilator processes and ASTs with the astsee suite</a>
</div>
</div>
</article>
</div>
</div>
</div>
</section>
<footer class="footer pt-xxl-19 pt-8 pb-sm-7 pb-5" id=footer>
<div class=container-fluid>
<div class=footer-wrapper>
<div class=row>
<div class="col-12 col-lg-4 me-auto order-2 order-lg-1">
<div class="footer-logo mt-7 mt-md-0 mb-5">
<a href=/>
<img src=/images/chips-logo-white.svg alt=logo>
</a>
</div>
<div class=social-icon>
<ul class=list-unstyled>
<li>
<a href=https://twitter.com/chipsalliance> <i class=ph-twitter-logo></i> </a>
</li>
<li>
<a href=https://github.com/chipsalliance> <i class=ph-github-logo></i> </a>
</li>
<li>
<a href=https://www.linkedin.com/company/chipsalliance/> <i class=ph-linkedin-logo></i> </a>
</li>
</ul>
</div>
<div class="footer-logo mt-7 mt-md-0">
<p>
© Copyright <span>2024</span> CHIPS Alliance
The Linux Foundation® . All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href=https://www.linuxfoundation.org/trademark-usage>Trademark Usage</a> page. Linux is a registered trademark of Linus Torvalds. <a href=http://www.linuxfoundation.org/privacy>Privacy Policy</a> and <a href=http://www.linuxfoundation.org/terms>Terms of Use</a>.
</p>
</div>
</div>
<div class="col-6 col-md-4 col-sm-4 col-lg-2 order-1">
<div class=footer-widget>
<h3>About</h3>
<ul class=list-unstyled>
<li>
<a href=/about/who-we-are/>Who We Are</a>
</li>
<li>
<a href=/about/members/>Members</a>
</li>
<li>
<a href=https://members.chipsalliance.org/>Member Support</a>
</li>
<li>
<a href=/about/governance/>Governance</a>
</li>
<li>
<a href=/about/faq/>FAQ</a>
</li>
<li>
<a href=/about/contact/>Contact</a>
</li>
</ul>
</div>
</div>
<div class="col-6 col-md-4 col-sm-4 col-lg-2 order-1">
<div class=footer-widget>
<h3>Community</h3>
<ul class=list-unstyled>
<li>
<a href=/projects/>Projects</a>
</li>
<li>
<a href=/getting-started/>Getting Started</a>
</li>
<li>
<a href=/events/>Events</a>
</li>
<li>
<a href=/workgroups/>Workgroups</a>
</li>
</ul>
</div>
</div>
<div class="col-6 col-md-4 col-sm-4 col-lg-2 order-1">
<div class=footer-widget>
<h3>News</h3>
<ul class=list-unstyled>
<li>
<a href=/categories/announcements/>Announcements</a>
</li>
<li>
<a href=/categories/blog/>Blog</a>
</li>
<li>
<a href=/categories/reports/>Reports</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</footer>
<script src=/vendor/jQuery/jquery.min.js></script>
<script src=/vendor/bootstrap/bootstrap.bundle.min.js></script>
<script src=/vendor/counter-up/countup.js></script>
<script src=/vendor/magnific-popup/magnific-popup.min.js></script>
<script src=/js/script.js></script>
</body>
</html>